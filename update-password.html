<!DOCTYPE html>
<html lang="he">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>驻住 住住</title>
    <link rel="stylesheet" href="style6.css">
</head>

<body>
    <h2>驻住 住住</h2>
    <p>  住住 砖</p>
    <input type="password" id="newPassword" placeholder="住住 砖">
    <input type="password" id="confirmPassword" placeholder="转 住住">
    <div id="error" class="message" style="color: red;"></div>
    <button onclick="updatePassword()">注 住住</button>

    <script type="module">
        import { createClient } from 'https://cdn.jsdelivr.net/npm/@supabase/supabase-js/+esm';

        const SUPABASE_URL = 'https://izpbbjhikbbbyahxzhkg.supabase.co';
        const SUPABASE_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Iml6cGJiamhpa2JiYnlhaHh6aGtnIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDgxOTMxMDUsImV4cCI6MjA2Mzc2OTEwNX0.Gv0WaUlkUAW1qBNEaaXDCWWpwWgbvBTya8KQzFhx08s';
        const supabase = createClient(SUPABASE_URL, SUPABASE_KEY);

        // 砖驻转 拽
        const hashParams = new URLSearchParams(window.location.hash.substring(1));
        const accessToken = hashParams.get('access_token');
        const refreshToken = hashParams.get('refresh_token');
        const type = hashParams.get('type');

        async function initializeSession() {
            if (type !== 'recovery' || !accessToken) {
                const error = document.getElementById('error');
                error.textContent = '拽砖专  转拽  驻 转拽祝.';
                error.style.display = 'block';
                document.querySelector('button').disabled = true;
                return;
            }

            const { error } = await supabase.auth.setSession({
                access_token: accessToken,
                refresh_token: refreshToken
            });

            if (error) {
                document.getElementById('error').textContent = '砖 转: ' + error.message;
                document.getElementById('error').style.display = 'block';
                document.querySelector('button').disabled = true;
            }
        }

        initializeSession();

        //    志onclick
        window.updatePassword = async function () {
            const newPassword = document.getElementById('newPassword').value.trim();
            const confirmPassword = document.getElementById('confirmPassword').value.trim();
            const errorDiv = document.getElementById('error');

            if (!newPassword || !confirmPassword) {
                errorDiv.textContent = '砖  转  砖转.';
                errorDiv.style.display = 'block';
                return;
            }

            if (newPassword !== confirmPassword) {
                errorDiv.textContent = '住住转  转转.';
                errorDiv.style.display = 'block';
                return;
            }

            if (newPassword.length < 8) {
                errorDiv.textContent = '住住 转 转 驻转 8 转.';
                errorDiv.style.display = 'block';
                return;
            }

            const { error } = await supabase.auth.updateUser({
                password: newPassword
            });

            if (error) {
                errorDiv.textContent = '砖 注 住住: ' + error.message;
                errorDiv.style.display = 'block';
                return;
            }

            alert('住住 注 爪!');
            window.location.href = 'index.html';
        };
    </script>

</body>

</html>
